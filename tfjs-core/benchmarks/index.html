<html>

<body>
  <script src="./tf-core.js"></script>
  <script src="./tf-converter.js"></script>
  <script>
    'use strict';

    tf.registerOp('BroadcastTo', node => {
      const x = node.inputs[0];
      const shape = node.inputs[1];
      return x.expandDims(0);
    });

    tf.registerOp('MatrixBandPart', node => {
      const x = node.inputs[0];
      const numLower = node.inputs[1].arraySync();
      const numUpper = node.inputs[2].arraySync();
      return tf.linalg.bandPart(x, numLower, numUpper);
    });

    async function onPageLoad() {
      console.log("loading model...");
      await tf.ready();
      const url =
          'https://storage.googleapis.com/learnjs-data/tfjs_graph_music_decode_target/model.json';
      const model = await tf.loadGraphModel(url);
      console.log("model loaded!");
      console.log("starting prediction...")
      console.time("time to predict")
      let res = await model.executeAsync({
          'decode_length': tf.scalar(50, 'int32'),
          'targets': tf.tensor2d([185, 290, 46, 49, 219, 292], [1, 6], 'int32')
        });

      res = await res.data();
      console.timeEnd("time to predict");

      console.log(res);
    }

    onPageLoad();
  </script>
</body>

</html>
